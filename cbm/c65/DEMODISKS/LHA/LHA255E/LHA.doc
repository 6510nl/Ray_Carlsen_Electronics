------------------------------------------------------------------------
          ＬＨＡ取り扱い説明書
                                                Ver.2.55    1992/11/15
------------------------------------------------------------------------
                                   NIFTY-Serve  SDI00506    吉崎　栄泰
                                   ASCII-pcs    pcs02846    Yoshi
                                   PC-VAN       FEM12376
------------------------------------------------------------------------

0. はじめに

　高圧縮書庫管理プログラム LHarc は、そのスピードの遅さにもかかわらず、
ネットワーカーの皆さんの多大なるご支援を受け、日本国内においては事実上標
準的なアーカイバの一つとして使われるに到りました。また、海外でも多くの方
々が使用して下さっているようで、たいへん嬉しく思っています。

　LHarc 公開直後から新しいアルゴリズムの検討を続けてきたのですが、じつに
２年近い時間が過ぎ去ってしまいました。ここに新しいアーカイバ LHA がようや
く実用段階となりましたので、公開致します。
                                                      (1991/02/24 記)


　LHA を LHarc と比較すると次のような違いがあります。

　良くなった点
　　・圧縮率の向上
　　　　とくに大きなファイルでは圧縮率が良くなっています。数百バイト以下
　　　　の小さなファイルでは逆に圧縮率が悪化することもありますが、やむを
　　　　得ないところでしょう。
　　・解凍速度の改善
　　　　アルゴリズムを動的ハフマン法から静的ハフマン法に変更したので、か
　　　　なり速くなりました。今までのようにいらいらしながら待つことはあま
　　　　りなくなるでしょう。ただ、圧縮速度は期待したほど速くはなりません
　　　　でした。残念。

　悪くなった点
　　・メモリ必要量が増加
　　　　かなり大きな空きメモリを必要とします。エディタやメニュープログラ
　　　　ムの子プロセスとして実行するときには注意が必要です。空きメモリが
　　　　不足しているときには、圧縮率を犠牲にして、極力実行を続けるように
　　　　しています。
　　・LHarc で解凍できない
　　　　互換モードを用意してはいますが、LHA で作成した書庫は LHarc では解
　　　　凍できません。逆はもちろん可能です。


　本プログラムは LHarc と同様にフリーソフトウェアとして公開致しますので、
コピー・使用は自由にしていただいてかまいません。もちろん企業内での使用や
政府機関での使用も全く制限致しません。ただし、本プログラムの使用にあたっ
ては、使用者自身の責任の下に行ってください。作者は何の保証もしませんし、
本プログラムを使用したことによって生じた損害を補償する義務も負いません。

　営利的な再配布に関しては若干の制限がありますので、4. の項をご覧下さい。


　それでは実際の使い方を説明することにします。


1. 使用法

  A. 一般的な書式

  　LHA <command> [-<option>[-+012|WDIR]...] LZH [[DIR\] [FILE]...]...

    <command>: 命令
    <option>: オプション
    LZH  : 書庫(archive)名
    DIR  : 基準ディレクトリ名
    FILE : ファイルのパス名
    WDIR : 作業ディレクトリ名


  B. 命令 <command>

    a (Add) 凍結（書き換え・追加）

      　ファイルを凍結（圧縮）して書庫(archive)に書き換え・追加します。書
      庫が存在しなければ、新しく作成します。書庫の中に同じ名前のファイル
      があるときには強制的に書き換えます。

      〈例 1〉LHA a ex *.exe

            拡張子に EXE の付いたファイルを全て EX.LZH というファイルに格
            納します。

    u (Update) 凍結（更新・追加）

      　a コマンドと同様に書庫にファイルを更新・追加しますが、書庫の中に
      同じ名前のファイルがあるときには更新日時の照合を行い、新しい方を書
      庫に残します。-c オプションを設定すると a コマンドと同じ動作をしま
      す。

      〈例 2〉LHA u ex *.c

            拡張子に C の付いたファイルを全て EX.LZH というファイルに格
            納します。すでに同じ名前のファイルが EX.LZH の中にあって、こ
            ちらの方が新しいときには何もしません。

    m (Move) 移動

      　u コマンドと同様にファイルを更新日時の照合を行いながら書庫に追加
      ・更新しますが、凍結元のファイルを削除します。-c オプションが設定さ
      れていると日時照合をしません。なお、名前が合致すると実際には凍結さ
      れなかった古いファイルも削除しますので、注意して使ってください。

      〈例 3〉LHA m ex *.c

            例 2 と同じ動作をしたあと、*.c に一致するファイルを全て削除
            します。

    f (Freshen) 凍結（更新）

        書庫の中のファイルと同名のファイルを探し、更新日時の新しいものが
      あれば書き換えます。-c オプションが設定されていると日時照合をしませ
      ん。

      〈例 4〉LHA f ex lha.doc

            EX.LZH の中に LHA.DOC というファイルが格納されていて、それが
            古いものであれば新しいものに入れ換えます。

    d (Delete) 削除

        書庫の中のファイルを削除します。

      〈例 5〉LHA d ex lha.doc

            EX.LZH の中の LHA.DOC というファイルを削除します。

    e (Extract) 解凍

      　書庫からファイルを解凍（復元して取り出）します。更新日時の新しい
      ファイルがあると通常はスキップしますが、-c オプションを設定すると解
      凍可能です。LArc で作成された標準的な書庫の解凍も可能です。（-lzs-, 
      -lz4-, -lz5- の圧縮ファイル）

      〈例 6〉LHA e ex

            EX.LZH の中のファイルを全て復元します。

      〈例 7〉LHA e ex *.com

            EX.LZH の中の拡張子が COM のファイルだけを復元します。

    x (eXtract) ディレクトリ展開つき解凍

      　書庫内のファイルがディレクトリ名付きで格納されているときには、デ
      ィレクトリ構造も再現しながら解凍します。「LHA E -x1m1」と等価です。

      〈例 8〉LHA x ex

            EX.LZH の中のファイルを全て、ディレクトリ付きで復元します。
            たとえば、BIN\CG86.EXE というファイルのときは、BIN というデ
            ィレクトリを作成し、ここに CG86.EXE を復元します。

    p (Print) 閲覧

      　書庫内のファイルを解凍して標準出力に表示します。

      〈例 9〉LHA p ex lha.doc

            EX.LZH の中の LHA.DOC を展開しながら画面に表示します。

      〈例 10〉LHA p ex lha.doc > prn

            EX.LZH の中の LHA.DOC を展開し、プリンタに出力します。

    l (List) 一覧

        書庫内のファイルの一覧表を表示します。

        -x オプションを設定していないときは１ファイル１行表示となり、ファ
      イル名のみが表示されます。書庫にパス名も記録されているときには、フ
      ァイル名の前に「+」が表示されます。

        -x オプションを設定したときには１ファイル２行表示となり、記録され
      ているパス名をそのまま全て表示します。

      〈例 11〉LHA l ex

            EX.LZH の中に格納されているファイルの一覧表を画面に表示しま
            す。

    v (View) 一覧

        l -x1 と同じです。

    t (Test) 検査

        書庫内のファイルの CRC コードをテストします。

        もう一つの機能として、配布された LHA.EXE や LHA????.EXE が改竄さ
      れていないかどうかをチェックすることができます。

        LHA t LHA.EXE とすると、「This file seems to be ORIGINAL distri-
      buted from H.Yoshi.」という表示が出ます。LHA????.EXE をテストしたと
      きには個々のファイルの CRC をチェックした後、同様の表示が出ます。

        自分自身をチェックする意味はほとんどありませんが、今後公開される
      新バージョンがオリジナルのものかをチェックする意味はあるでしょう。

        LEXEM, DIET, PKLITE や LZEXE をかけたものに対してはチェックできま
      せん。

      〈例 12〉LHA t ex

            EX.LZH の中に格納されているファイルが壊れていないかテストし
            ます。

      〈例 13〉LHA t LHA.EXE

            LHA.EXE が変更（改竄）されていないかテストします。

    s (Self-extract)

      　通常の書庫から自己解凍書庫(SFX : self-extracting archive)を作成し
      ます。用途により２種類の書庫が作成可能で、-x0 （既定値）で作成した 
      SFX（SMALL 版）は、ファイルをカレントディレクトリ以外には展開できま
      せん。また、自動実行機能もありませんが、サイズは少し小さくなってい
      ます。-x1 で作成した SFX（LARGE 版）は、ディレクトリ構造を再現した
      り、自動実行を行うことも可能です。

      〈例 14〉LHA s ex

            EX.LZH という書庫から EX.EXE という自己解凍書庫（SMALL 版）を
            作成します。


  C. オプション -<option>

    細かい動作を変更するオプションです。オプションは一般的に、0, 1, 2 の
    ３つの値を指定できますが、1 と 2 が同じ動作をするものもあります。従来
    どおり、-, + での設定や無指定による反転機能（0 なら 1 になり、1 か 0 
    なら 1 に変わる）も使えます。また、MS-DOS の設定により /<option> 形式
    でオプションを指定することもできます。


    -x[0|1] (allow eXtended file names)

      ファイルの出し入れの時にディレクトリ名を追加します。

        たとえば、\tc\include\sys\stat.h というファイルをルートディレクト
      リを基準に凍結するとき、-x0 のときは STAT.H というファイル名のみを
      書庫内に記録しますが、このスイッチを設定すると TC\INCLUDE\SYS\STAT
      .H とディレクトリ名付きで格納します。解凍のときも、このスイッチが設
      定されていると、ディレクトリ名が記録されていれば、そのディレクトリ
      上に解凍します。また、l コマンドにおいても記録されているパス名をそ
      のまま出力する２行表示モードとなります。


    -p[0|1] (distinguish full Path names)

      ファイル名の検索を厳密に行います。

      　たとえば、書庫 TC に STAT.H と SYS\STAT.H というファイル名の同じ
      ２つのファイルがあるとき、

        LHA e TC stat.h

      とすると、両方のファイルが解凍されてしまいます。そこで、

        LHA e -p TC stat.h

      とすることによって STAT.H のみが解凍できます。逆に、

        LHA e TC sys\stat.h

      とすることで、SYS\STAT.H だけが解凍されます。


    -c[0|1] (skip time-stamp Check)

      凍結・解凍のときに日時照合を行わない

      　u, f, e, x コマンドにおいて、転送先にパス名が同じで更新日時の新し
      いファイルがすでに存在していると、通常は凍結・解凍しません。このス
      イッチを設定すると、日時照合を無視します。


    -m[0|1|2] (no Message for query)

        問い合わせを行わず、問い合わせにたいして、すべて「Y」が入力された
      ものとして処理を続けます。

      　解凍時、同名のファイルが既に存在している時には -m1 と -m2 は異な
      る意味を持っています。
      
      -m1: 更新日時の照合を行い、書庫内のファイルの方が新しければファイル
           を更新します。

      -m2: 更新日時の照合を行わず、000 から 999 までの使用されていない拡
           張子に変更して解凍します。ただし、ish のような同一性のチェック
           は行っていません。


    -a[0|1|2] (allow any Attributes of files)

      すべての属性のファイルを凍結の対象とします。また解凍時には、元の属
      性を再現します。

      　凍結時 -a0 では、隠し属性・システム属性の付いたファイルは格納され
      ません。リードオンリー属性の付いたファイルはそのまま格納します。こ
      のとき、リードオンリー属性も保存されます。

      　凍結時 -a1 では、全てのファイルがそのままの属性で格納されます。

      　凍結時 -a2 はファイルの属性の取り扱いに関しては -a1 と同じですが、
      これを -r2x1 と同時に指定すると、ディレクトリ名も格納することができ
      ます。これは後述する -d1 オプションの指定と等価です。格納されたディ
      レクトリの圧縮法の表示は -lhd- となります。

      　解凍時 -a0 では、隠し属性・システム属性の付いたファイルは解凍され
      ません。リードオンリー属性の付いたファイルは解凍されますが、リード
      オンリー属性は保存されません。

      　解凍時 -a1 では、全てのファイルがそのままの属性で解凍されます。


    -r[0|1|2] (Recursively collect files)

      凍結・解凍時にファイルを再帰的に検索します。

      　ここで言う「再帰的」とは、下位レベルのディレクトリがあるときには
      それも含めてファイルを検索することを意味しています。


      ファイルの検索には３つのモードがあります。

      -r0: 非再帰モード

          　パス名で指定されたファイルだけを凍結・解凍します。

      -r1: ファイル名指定再帰モード

          　ディレクトリ名とファイル名を切り離し、指定されたディレクトリ
          以下のファイルを再帰的に検索し、ファイル名と一致するものを凍結
          ・解凍します。共通の名前を持ったファイルをまとめて選択するとき
          に使います。

      -r2: ディレクトリ指定再帰モード

          　パス名で指定されたディレクトリ以下の全てのファイルを凍結・解
          凍します。ディレクトリ構造をまとめて操作するときに使います。

　　　［注意］

　　　　　従来、解凍時に /x の代わりに /r を使っているバッチファイルを良
　　　　く見かけます。LHarc では解凍時には /r は無効で、連動して設定され
　　　　た /x の機能が働いていたのです。LHA では解凍時にも /r が有効となり、
　　　　/x が自動的に設定されることも無くなりましたので、注意してください。


    -w[0|1|<作業ディレクトリ名>] (assign Work directory)

      作業ファイルを作成するディレクトリを指定します。

      　-w に作業ディレクトリ名を続けると、-w+ が指定されたものと見なしま
      す。指定がなければ書庫と同じディレクトリに作業ファイルを作成し、処
      理が終了した時点で作業ファイルの名前を書庫名に変更します。作業ディ
      レクトリ名の指定なしに -w+ のみが指定されたときには、カレント・ドラ
      イブのカレント・ディレクトリに作業ファイルを作成します。

      　環境変数「TMP, TEMP」によって作業ディレクトリを設定しているときに
      も、-w スイッチが 1 に設定されます。


      　このスイッチは下記の場合に有効と思われます。

      1. 書庫のあるディレクトリ（ドライブ）に作業ファイルを作成する余裕が
         ないとき。

      2. RAM disk や HARD disk などの高速デバイスに作業ファイルを作成する
         ことにより、処理を高速化したいとき。


    -t[0|1] (archive's Time-stamp option)

      書庫の更新日時を、書庫内のファイルの最新の物に合わせます。

      　書庫を更新するコマンド（a, u, m, f, d）で有効です。このスイッチが
      指定されていないときには、書庫を更新した時刻そのものが書庫の更新日
      時となります。


    -z[0|1|2] (Zero compression)

      ファイルを圧縮せずに書庫に格納します。

      -z1 : 凍結する全てのファイルを圧縮しない。
      -z2 : LZH, LZS, ZIP, PAK, ARC, ZOO および次のオプションで登録した拡
            張子を持つファイルだけを圧縮せずに格納します。
      -z<extension> :
            指定した拡張子のファイルを無圧縮として登録します。同時に -z2 
            が指定されたものとみなします。
            拡張子の記述にはワイルドカードも使用できますし、先頭に '.' を
            付けても付けなくてもかまいません。拡張子無しのファイルを指定
            するときには -z. とします。また、-zexe -zcom などと複数の拡張
            子を無圧縮指定することもできます。


    -o[0|1] (use Old compatible method)

    　LHarc ver.1.xx で解凍できる書庫を作成します。

    　　アルゴリズムの変更により、LHarc よりも少しコンパクトな書庫が作成
    　できます。このときには自動的に -h0 が選択されます。


    -h[0|1|2] (select Header level)

    　ヘッダの形式を選択します。既定値は -h1 です。


    -i[0|1|2] (not Ignore lower case)

    　解凍時のファイルの選択において、大文字と小文字を区別します。

    　　他の OS 版の LHA(LHarc) で作成された書庫では、ファイル名に大文字
    　と小文字が混在している可能性があります。また移植版のソースなどでも
    　元のファイル名を残したいときもあります。このようなときにこのオプシ
    　ョンを使って下さい。

      a. 書庫内のファイルを検索するコマンド(f, d, s, e, x, t, p, l, v)
        -i0      大文字・小文字を同一のものとして検索
        -i1,-i2  大文字・小文字を区別して検索

      b. 外部のファイルを検索するコマンド(a, u, m)
        -i0  すべて大文字に変換して書庫に記録
        -i1  ワイルドカードを含むファイル名はすべて大文字に変換
             それ以外はそのまま書庫に記録
        -i2  ワイルドカードを含むファイル名はすべて小文字に変換
             それ以外はそのまま書庫に記録


    -n[0|1|2] (display No indicator and/or pathname)

      凍結・解凍時の ooo..... という表示をしません。

      -n1 : ooo..... という表示を抑制します。
      -n2 : さらにファイル名の表示も抑制します（非常に寡黙になります）。


    -l[0|1|2] (display Long name with indicator)

      凍結・解凍時のファイル名の表示法を変更します。

      -l0 : ファイル名だけを表示します。
      -l1 : 書庫内に記録する（されている）パス名を表示します。
      -l2 : 実際にアクセスするパス名を表示します。

      　なお、-l1, -l2 では２行表示となります。


    --[1|2] ('@' and/or '-' as usual letters)

      以降のオプション・レスポンスファイルの指定を無効とし、最初の文字が 
      '-', '@' である書庫名やファイル名を正しく認識するようにします。

      　--1 では '@' のみを、--2 では '@' と '-' の両方を通常の文字として
      認識します。

      　指定の解除は '/-[0]' で可能です。'--0' ではファイル名と判断してし
      まいます。


    -s[0|1] (Skip by time is not reported)

      "Skipped  FILENAME.EXT : 最新のファイルが存在" という表示を抑制しま
      す。


    -d[0|1] (pack Direcrory name also)

      凍結時、単独のディレクトリ名を含め、全ての属性のファイルを再帰的に
      格納します。

      　-d1 は -r2x1a2 を指定したのと同じです。-r2, -x1, -a2 のオプション
      は解凍時にも作用することに注意して下さい。


    -f[0|1] (Force to write files without previous check)

      　ディスク残量のチェックを中止します。

      　凍結・解凍時、LHA は必要なディスク容量が予測できる時には作業を開
      始する前にディスク残量をチェックしていますが、このために非公開ファ
      ンクションコールを利用しています。ネットワークなどの一部のドライバ
      では正常に機能しないことがあるようです。このようなときには -f1 を指
      定して下さい。


  D. 基準ディレクトリについて

    　基準ディレクトリをうまく使うことにより、複数のディレクトリに散在す
    るファイルを自由に選択凍結したり、複数のディレクトリに解凍したりする
    ことが可能となります。

    　基準ディレクトリは、凍結・解凍するファイルのディレクトリの取り扱い
    を、カレントドライブ・ディレクトリをそこに移動してから LHA を実行した
    時と同じにします。複数指定が可能で、次の基準ディレクトリ名が指定され
    るまで有効です。また、a: といったドライブ名の指定も有効で、そのドライ
    ブのカレントディレクトリを指定したことになります。

         （例）
             A>lha x lha212 b:\lha\inc\ *.h c: *.c
                            ~~~~~~~~~~~     ~~
                          ‖
             A>b:
             B>cd \lha\inc
             B>a:lha x a:lha212 *.h
             B>c:
             C>a:lha x a:lha212 *.c

    　ただし、１つのファイルを複数のディレクトリに解凍することはできず、
    先に指定した方が有効となります。

         （例）
             A>lha x lha212 b:\lha\inc\ lha.h c: *.h
                            ~~~~~~~~~~~       ~~
             LHA.H は B:\LHA\INC\LHA.H として解凍されます。


  E. レスポンスファイルと入力のリダイレクト

    　MS-DOS のコマンドラインは字数制限があり、たくさんのファイルを一度に
    指定することができません。そこで、レスポンスファイル機能と入力のリダ
    イレクト機能を用意しました。

    a. レスポンスファイル

      　レスポンスファイルは MASM や LINK と同様に先頭に @ を付けて区別し
      ます。ファイルの内容はコマンドラインに書く書式と同じです。改行文字
      は空白とみなされますので、複数行に分けて書いてもかまいません。ファ
      イル中に命令やオプションを記述することもできます。

      　レスポンスファイルの中から他のレスポンスファイルを呼び出す（多重
      ネスト）ことはできません。この場合には @ で始まるファイル名として
      認識されます。

    b. 入力のリダイレクト

      　レスポンスファイルと同様の内容を、リダイレクトやパイプを使って渡
      すことも可能です。リダイレクト中でレスポンスファイルを指定すること
      もできます。

    （使用例）
        　PARTS.LZH の中のファイル名一覧を FILES に作成し、NEWPARTS.LZH 
        という新しい書庫を作成する。

          A>lha l -n1 parts > files
          A>lha a newparts @files

        　ls でファイル名一覧を作成し、ソートした上で書庫 ALL.LZH を作成
        する。（ls はいろいろなものが出回っていますので、Software-Tools 
        のものを標準としています。出力形式の異なるものに注意）

          A>ls | sort | lha a all


  F. 拡張ワイルドカードについて (ver.2.54 以降)

      MS-DOS のワイルドカードを拡張し、少し複雑な検索ができるようになりま
      した。このルーチンには LSI C のワイルドカード展開ルーチンのソースを
      改変して利用させて頂きました。

      以下のワイルドカードが使えます。

          ?   任意の 1 文字('.' を含まない)
          *   0 文字以上の任意の文字列('.' を含まない)
          +   0 文字以上の任意の文字列('.' を含む)
          []  括弧内に列挙した文字のいずれか。[a-z] と範囲指定も可能

      例えば FLABO[_~][1-9A] は、CUE + MYRES や AIR + CRAFT で作成された
      FLABO の会議室のログファイル FLABO_1 〜 FLABO_A, FLABO~1 〜 FLABO~A 
      とマッチしますが、FLABO_ というファイルとはマッチしません。すべてが
      マッチするためには FLABO[_~]* とします。

      + は全てのファイル名とマッチします。ファイルのパス名が省略された場
      合には、lha は + を付加しています。


  G. 環境変数

    a. LHA と LHARC

      　オプションの既定値を設定するために使います。LHA があれば LHARC は
      無視されます。

    b. TMP と TEMP

      　-w オプションと同様に、作業ファイルを作成するディレクトリを設定し
      ます。なお、作業ファイルを作成するディレクトリが存在しないときには
      カレントドライブのカレントディレクトリに作業ファイルを作成します。
      TMP があれば TEMP は無視されます。

    c. TZ

      　-h2 で凍結するとき、-h2 で凍結された書庫を解凍するときに設定しな
      ければいけません。さもなければ、タイムスタンプが狂います。日本国内
      では MS-DOS のコマンドで set TZ=JST-9 と設定します。


  H. 終了コード

      バッチファイルなどに返される終了コードは以下のとおりです。

    0   正常終了。

    1   解凍のとき、ＣＲＣエラーが起きたか、ディスクの容量が足りず解凍で
        きないファイルがあった。または、指定されたファイル名の中に使用さ
        れないものがあった。

    2   致命的なエラーなどのため処理を中止した。書庫は更新されていない。

    3   作業ファイルを書庫に書き戻せなかった。作業ファイル LHTMP???.LZH 
        が残っている。

    作業ファイル LHTMP???.LZH は書庫の形式を保っていますので、リネームし
    て書庫として使用可能です。


  I. 作業ファイル名

    LHTMP000.LZH, LHTMP001.LZH 〜 LHTMPFFF.LZH と代えて検索し、そのディレ
  クトリに存在しないファイル名を作業ファイル名として使用します。通常は意
  識する必要はありません。


2. 自己解凍書庫

  　自己解凍書庫(SFX)とは、自分自身を実行することによって書庫内のファイル
  を展開・再現する機能を持っています。LHA の配布ファイル自体も SFX となっ
  ています。LHA で作成できる SFX は、LHA で作成された書庫からのみ可能です。
  LHarc で作成された書庫からは作成できませんので、注意してください。LHA で
  は -x オプションの設定により、２種類の SFX を選択することができます。ま
  ずはじめに、以下に LHA の SFX が持っている特別な機能を解説します。

    A. テロップ機能

      　ファイル名が「!」であるファイルを自己解凍書庫内に見つけると、ディ
      スクには解凍せず、展開した内容を画面に表示します。表示終了後、[Y/N] 
      と表示して一旦停止しますので、ここでキーボードから「Y」を入力すると
      以降の動作を継続します。ここで「N」を入力するとそこで処理を中止しま
      す。

    B. 解凍先ディレクトリの指定（-x1 で作成した SFX のみ）

      　SFX 実行時、コマンドラインに解凍したいディレクトリを直接入力する
      ことによって、指定します。たとえば LHA212.EXE というファイルの場合
      には、LHA212 A:\USER とすることにより A:\USER\ というディレクトリ上
      にファイルを解凍します。また、LHarc の SFX との互換性のため、-e オ
      プションでの解凍先ディレクトリの指定も有効です。

    C. 自動実行機能（-x1 で作成した SFX のみ）

      　コマンドラインに -! オプションを指定すると、解凍終了後、書庫から
      解凍した「!.BAT」を実行します。「!.BAT」は解凍先ディレクトリが指定
      されていても、常にカレントディレクトリに解凍されます。また、既にカ
      レントディレクトリに「!.BAT」が存在する場合には上書きされます。また、
      「!.BAT」が書庫内に無いときには、既に「!.BAT」というファイルが既に
      カレントディレクトリに存在していても自動実行機能は働きません。


  　つぎに、２種類の自動解凍書庫の機能について解説します。

    A. -x0 で作成した SFX（SMALL 版）

      　この場合には、元になった書庫がディレクトリ付きであっても、SFX に
      はファイル名だけが記録されています。解凍先ディレクトリ指定もできま
      せんので、常にカレントディレクトリに解凍されます。自動実行機能もあ
      りませんが、テロップ 機能は使えます。LHarc の small 版とは違い、書
      庫サイズの制限はありません。

    B. -x1 で作成した SFX（LARGE 版）

      　テロップ機能・解凍先ディレクトリ指定機能・自動実行機能の全てが使
      えます。また、元になる書庫のファイルがディレクトリ付きで格納されて
      いるときにはそのままの形でパス名を記録しているので、SFX 解凍時にデ
      ィレクトリ構造を再現します。この機能を抑制する時には SFX 実行時に 
      -x オプションを指定します。

      　コマンドラインオプションをまとめておきます。

        SFX.EXE [-x] [-!] [-a] [-eDIR] [DIR]

          -x : ディレクトリ展開の抑制
          -! : 自動実行
          -a : 属性の復元
          -eDIR or DIR : 解凍先ディレクトリの指定


3. LHarc との操作上の相違点

　LHA は LHarc を継承したソフトですが、かなり書き換えてしまったので「似て
非なる」ソフトとなっています。おもな相違点を以下に示しましたが、もっとた
くさんの変更点がありますので、注意してください。


　☆ ファイルがソートされない

  　従来の LHarc ともっとも異なる点は、書庫内のファイルがソートされて格納
  されないことです。全く新しい書庫を作成するときには、指定した順番に格納
  されていきます。ワイルドカードがあれば、ディレクトリ内の順番に従います。
  古い書庫に追加するときには、書庫内に無いファイルは後に追加していきます。

  　ソートされた書庫を作りたいときには、dsort, ordir, fd などのユーティリ
  ティで予め順番に配置しておくか、リスポンスファイルにソートしたファイル
  名一覧を作っておくと良いでしょう。

    A>ls *.c *.h | sort | lha a LZH

  　などとすることもできます。

　☆ -r オプションと -x の連動を中止

  　解凍時にも -r の指定を有効としたため、-x との連動を止めました。

　☆ x コマンド

  　このバージョンでは、X コマンドを E -x1m1 と等価としてみました。すなわ
  ち、ディレクトリ構造も復元しながら解凍します。

　☆ 自己解凍ファイルの自動実行機能の変更

　　LHarc では AUTOLARC.BAT を実行していましたが、LHA では !.BAT に変更し
　ました。また、キーワード比較での自動実行は止め、-! オプションによる実行
　許可としました。

　☆ タイムスタンプについて

  　LHA では内部的にタイムスタンプを 1970-01-01 00:00:00 UTC からの通算秒
  に変換しています。このため、実在しないスタンプ（80-00-00 など）を持った
  ファイルを格納した場合、タイムスタンプは不定となります。


4. 使用・再配布・移植・改良について

  　本プログラムは、著作権を放棄していないいわゆる「フリーソフトウェア」
  です。以下の条件に従って、自由に使用していただいてかまいません。

    1. 著作権表示を変更しないこと。
    2. この LHA.DOC も同時に配布すること。
    3. 改変を加えたとき（移植・改良など）には、改変者の氏名（ペンネーム）
       ・連絡先などとともに、変更が加えられていることを明示すること。
    4. このプログラムを使用したことによって生じた損害は、全く保証しない。
    5. 作者は、このプログラムに不備があっても、それを訂正する義務を負わな
       い。
    6. 雑誌・商品などに添付して再配布する場合には、少なくとも１か所に著作
       権表示を印刷（タイプ）すること。なお、意図的にバックアップを禁止し
       ている（コピープロテクトされている）ソフトとの同時配布は原則として
       禁止します。

    いずれの場合にも作者への許諾は不用です。ときとして使用許諾のメールの
  嵐にみまわれて閉口することもありましたので、ご報告に留めていただければ
  幸です。

  　なお当然の事ながら、自己解凍形式を含め LHA で作成された書庫の配布には
                        ~~~~~~~~~~~~~~~~~~
  制限はありません。自由にご利用になって下さい。


5. 連絡先

  　感想・バグレポートなどはなるべく、NIFTY-Serve ソフトウェア工房(FLABO)
  の会議室までお願い致します。メールでのお問い合わせもお受けしますが、ご
  返事が遅れる、あるいは行かないことも予想されます。また、頂いたメールは 
  FLABO の会議室で公開することもありますので、予めご了承下さい。

  ［電子メール］

          NIFTY-Serve      SDI00506 | PFF00253   吉崎　栄泰
          ASCII-NET pcs    pcs02846              Yoshi
          PC-VAN           FEM12376              吉崎　栄泰

  ［郵政省メール］

    　    〒080 帯広市東 4 条南 12 丁目　帯広協会病院 内科


6. 最後に

  本プログラムの作成には以下の公開ソフトウェアを使用しました。

    A-MACROS / 構造化アセンブラＭＡＣＲＯＳ
    AMSCLS.INC (c) Hortense S. Endoh 1986, 1987
    Ver.2.10

  有用なソフトを公開していただき、ありがとうございました。

  また、ver.2.55 からは

    LSI C-86 Ver 3.30b 製品版
    エル・エス・アイ  ジャパン（株）

  を使用しています。


  　LHarc の公開によって、PKZIP や PAK などの圧縮アルゴリズム全体が進化し
  たことは事実だと自負しています。私にとってはこれだけで良かったのですが、
  いろいろな方々のご支援や励ましを受けながら、またここまでたどり着きまし
  た。

    圧縮アルゴリズムの理論的な指導をしてくださった奥村晴彦さんと PC-VAN 
    SIG サイエンスの皆さん

    アーカイバ作成の契機・公開の場所を与えてくださった三木和彦さん

    英文マニュアルの作成・海外への窓口となってくださった大久保謙二郎さん

    英文マニュアルを英語らしい表現に書き換えてくださった Irv Hoff さん

    英文マニュアルの作成に協力して下さった NIFTY-Serve の翻訳フォーラムの
    皆さん

    いろいろとテストして下さった NIFTY-Serve のソフトウェア工房の皆さん


  そしてこれまで LHarc, LHA を使って下さった全ての皆さんに深謝致します。


7. 参考資料

   1) Knuth, D. E., Dynamic Huffman Coding, J. Algorithms, 6:163-180, 
      1985.

   2) AP-Labo 編著, ハードディスク・クックブック, 翔泳社(1987).

   3) 栗田多喜夫, コンピューティングの玉手箱 43, ハフマン符号化法, 
      ｂｉｔ, 20:7:100-101 (1988).

   4) 奥村晴彦, 益山健, 三木和彦, 必読・データ圧縮のアルゴリズムと実践, 
      The BASIC, 70(March):1-65, 1989.

   5) Fiala, E. R. and Greene, D. H., Data Compression with Finite 
      Windows, Commun. ACM, 32:490-595, 1989.

   6) 奥村晴彦, 吉崎栄泰, 特集・圧縮アルゴリズム入門, Ｃマガジン, 3:1:44
      -68, 1991.
